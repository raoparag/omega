<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<window xmlns="http://schemas.haulmont.com/cuba/screen/window.xsd"
        caption="msg://caption"
        messagesPack="com.srt.omega.web.dashboards">
    <dsContext>
        <collectionDatasource id="showsDs"
                              class="com.srt.omega.entity.Show"
                              view="show-view">
            <query>
                <![CDATA[select e from omega$Show e]]>
            </query>
        </collectionDatasource>
        <valueCollectionDatasource id="salesByIndustryDs">
            <query>
                <![CDATA[
                    select s.name, sum(t.capacity) from omega$Show s join s.ticketCategories t
                    where s = :ds$showsDs group by s.name
                ]]>
            </query>
            <properties>
                <property class="com.srt.omega.entity.Show"
                          name="show"/>
                <property datatype="decimal"
                          name="sum"/>
            </properties>
        </valueCollectionDatasource>
        <valueCollectionDatasource id="individualSalesDs">
            <query>
                <![CDATA[select b.organisation.name, sum(b.totalPaidTickets)
                    from omega$Booking b
                    where b.show = :ds$showsDs
                    group by b.organisation.name]]>
            </query>
            <properties>
                <property class="com.srt.omega.entity.Show"
                          name="show"/>
                <property datatype="decimal"
                          name="sum"/>
            </properties>
        </valueCollectionDatasource>
        <collectionDatasource
                id="showTimingsDs" class="com.srt.omega.entity.ShowTiming"
        >
            <query><![CDATA[select e from omega$ShowTiming e
                    where e.show = :ds$showsDs ]]>
            </query>
        </collectionDatasource>
    </dsContext>
    <dialogMode height="600"
                width="800"/>
    <layout spacing="true">
        <hbox spacing="true">
            <lookupField id="showLookup"
                         caption="Select Show"
                         optionsDatasource="showsDs"
                         width="400px"/>
            <lookupField id="showTimeLookup"
                         caption="Select ShowTime"
                         optionsDatasource="showTimingsDs"
                         width="400px"/>
        </hbox>
    </layout>
</window>